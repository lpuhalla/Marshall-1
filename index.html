<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformers.js Example</title>
    <!-- Add ONNX Runtime Web first -->
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0/+esm';

        // Configure environment
        env.useBrowserCache = false;
        env.backends.onnx.wasm.wasmPaths = 'https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/';

        let model;

        // Function to load the model
        async function loadModel() {
            try {
                document.getElementById("loadingMessage").style.display = "block";
                document.getElementById("loadingMessage").textContent = "Loading model (this might take a minute)...";
                
                // Use pipeline for text generation
                model = await pipeline('text-generation', 'lpuhalla/Marshall-1', {
                    credentials: {
                        accessToken: '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'
                    }
                });
                
                document.getElementById("loadingMessage").style.display = "none";
                document.getElementById("generateButton").disabled = false;
                console.log("Model loaded successfully");
            } catch (error) {
                console.error("Error loading the model:", error);
                document.getElementById("loadingMessage").textContent = 
                    `Error loading model: ${error.message}. Check console for details.`;
            }
        }

        // Function to generate text
        async function generateText() {
            if (!model) {
                document.getElementById("generatedText").textContent = "Model not loaded yet. Please wait...";
                return;
            }
            
            const inputText = document.getElementById("inputText").value;
            if (!inputText) {
                document.getElementById("generatedText").textContent = "Please provide some input text.";
                return;
            }

            try {
                document.getElementById("generateButton").disabled = true;
                document.getElementById("generatedText").textContent = "Generating...";
                
                const result = await model(inputText, {
                    max_length: 50,
                    temperature: 0.7
                });
                
                document.getElementById("generatedText").textContent = result[0].generated_text;
            } catch (error) {
                console.error("Error during text generation:", error);
                document.getElementById("generatedText").textContent = 
                    `Error generating text: ${error.message}. Check console for details.`;
            } finally {
                document.getElementById("generateButton").disabled = false;
            }
        }

        // When the DOM is loaded, set up the event listeners and load the model
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize button as disabled until model loads
            document.getElementById("generateButton").disabled = true;
            document.getElementById("generateButton").addEventListener("click", generateText);
            // Start loading the model
            loadModel();
        });
    </script>
</head>
<body>
    <h1>Text Generation with Your Hugging Face Model</h1>
    <textarea id="inputText" placeholder="Type something..." rows="4" cols="50"></textarea><br>
    <button id="generateButton">Generate Text</button>
    <h2>Generated Text</h2>
    <pre id="generatedText"></pre>
    <div id="loadingMessage" style="display:none;">Loading model...</div>
</body>
</html>
