<!--
    Version: 1.0
    Last updated: January 28, 2025
    Description: Example for using Transformers.js with a Hugging Face model.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformers.js Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0/dist/transformers.min.js"></script>
</head>
<body>
    <h1>Text Generation with Your Hugging Face Model</h1>
    <textarea id="inputText" placeholder="Type something..." rows="4" cols="50"></textarea><br>
    <button id="generateButton" disabled>Generate Text</button>
    <h2>Generated Text</h2>
    <pre id="generatedText"></pre>
    <div id="loadingMessage">Loading model...</div>

    <script>
        let model;

        async function loadModel() {
            try {
                document.getElementById("loadingMessage").textContent = "Loading model (this might take a minute)...";
                
                // Use pipeline for text generation
                model = await pipeline('text-generation', 'lpuhalla/Marshall-1', {
                    credentials: {
                        accessToken: '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'
                    }
                });
                
                document.getElementById("loadingMessage").style.display = "none";
                document.getElementById("generateButton").disabled = false;
                console.log("Model loaded successfully");
            } catch (error) {
                console.error("Error loading the model:", error);
                document.getElementById("loadingMessage").textContent = 
                    `Error loading model: ${error.message}. Check console for details.`;
            }
        }

        async function generateText() {
            if (!model) {
                document.getElementById("generatedText").textContent = "Model not loaded yet. Please wait...";
                return;
            }
            
            const inputText = document.getElementById("inputText").value;
            if (!inputText) {
                document.getElementById("generatedText").textContent = "Please provide some input text.";
                return;
            }

            try {
                document.getElementById("generateButton").disabled = true;
                document.getElementById("generatedText").textContent = "Generating...";
                
                const result = await model(inputText, {
                    max_length: 50,
                    temperature: 0.7
                });
                
                document.getElementById("generatedText").textContent = result[0].generated_text;
            } catch (error) {
                console.error("Error during text generation:", error);
                document.getElementById("generatedText").textContent = 
                    `Error generating text: ${error.message}. Check console for details.`;
            } finally {
                document.getElementById("generateButton").disabled = false;
            }
        }

        // Initialize after DOM content is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Make sure pipeline is available
            if (typeof pipeline === 'undefined') {
                const message = "Error: Transformers.js failed to load properly. Please check your internet connection and try again.";
                document.getElementById("loadingMessage").textContent = message;
                console.error(message);
                return;
            }

            document.getElementById("generateButton").addEventListener("click", generateText);
            loadModel();
        });
    </script>
</body>
</html>
